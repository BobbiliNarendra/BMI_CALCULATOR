<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BMI & Body Fat Calculator — Your Health Snapshot</title>
  <meta name="description" content="Single-page BMI and body fat calculator with tips for improvement. Responsive, accessible, and embeddable on any blog." />
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa7b2;--accent:#06b6d4;--success:#10b981;--danger:#ef4444;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0;background:linear-gradient(180deg,#071123 0%, #07182a 100%);color: #e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .wrap{width:100%;max-width:900px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
    .brand{font-weight:700;font-size:20px;color:var(--accent)}
    .card{background:var(--card);border-radius:12px;padding:20px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    form .row{display:flex;gap:12px;margin-bottom:12px}
    .col{flex:1;min-width:0}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="number"], select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);color:inherit}
    .units{display:flex;gap:8px}
    .units button{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;cursor:pointer}
    .units button.active{background:linear-gradient(90deg,rgba(6,182,212,0.12), rgba(6,182,212,0.06));border-color:rgba(6,182,212,0.28)}
    .actions{display:flex;gap:12px;align-items:center}
    .btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer}
    .btn.primary{background:var(--accent);color:#022;box-shadow:0 6px 18px rgba(6,182,212,0.08)}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:white}
    .results{margin-top:18px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.03)}
    .result-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .result-item{padding:12px;border-radius:8px;background:rgba(255,255,255,0.015)}
    .muted{color:var(--muted);font-size:13px}
    .badge{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:600}
    .tips{margin-top:12px}
    .tips li{margin-bottom:8px}
    footer{margin-top:12px;font-size:13px;color:var(--muted)}
    @media (max-width:700px){.result-grid{grid-template-columns:1fr}}
    .share-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .copy-tip{font-size:12px;color:var(--muted)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <header>
      <div class="brand">e-Blogger • Health Tools</div>
      <div class="muted">Single-page BMI + Body Fat Calculator (embeddable)</div>
    </header>

    <section class="card" aria-labelledby="calculatorHeading">
      <h1 id="calculatorHeading" style="margin:0 0 12px 0;font-size:18px">BMI & Body Fat Calculator</h1>

      <form id="calcForm" onsubmit="return false;" novalidate>
        <div class="row">
          <div class="col">
            <label for="unitToggle">Units</label>
            <div class="units" role="radiogroup" aria-labelledby="unitToggle">
              <button type="button" id="unitMetric" class="active" aria-pressed="true">Metric (kg, cm)</button>
              <button type="button" id="unitImperial" aria-pressed="false">Imperial (lb, in)</button>
            </div>
          </div>
          <div class="col">
            <label for="sex">Sex</label>
            <select id="sex" aria-label="sex">
              <option value="1">Male</option>
              <option value="0">Female</option>
            </select>
          </div>
          <div class="col">
            <label for="age">Age (years)</label>
            <input id="age" type="number" min="5" max="120" value="30" />
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label for="weight">Weight</label>
            <input id="weight" type="number" inputmode="decimal" step="0.1" min="1" value="70" aria-describedby="weightHelp" />
            <div id="weightHelp" class="muted">kg or lb depending on units</div>
          </div>

          <div class="col">
            <label for="height">Height</label>
            <input id="height" type="number" inputmode="decimal" step="0.1" min="20" value="170" aria-describedby="heightHelp" />
            <div id="heightHelp" class="muted">cm or inches depending on units</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="calculateBtn">Calculate</button>
          <button class="btn ghost" id="resetBtn" type="button">Reset</button>
          <div style="margin-left:auto" class="muted">Result is informational only — not medical advice.</div>
        </div>

        <div id="results" class="results" hidden aria-live="polite">
          <div class="result-grid">
            <div class="result-item">
              <div class="muted">BMI</div>
              <div style="font-size:22px;font-weight:700" id="bmiVal">--</div>
              <div class="muted" id="bmiCat">--</div>
            </div>
            <div class="result-item">
              <div class="muted">Estimated Body Fat % (Deurenberg)</div>
              <div style="font-size:22px;font-weight:700" id="bfVal">--</div>
              <div class="muted" id="bfCat">--</div>
            </div>
          </div>

          <div class="tips">
            <h3 style="margin:12px 0 8px 0">Tips to improve</h3>
            <ul id="improveTips">
              <!-- filled by JS -->
            </ul>
          </div>

          <div class="share-row">
            <button class="btn ghost" id="saveLocal">Save result (local)</button>
            <button class="btn ghost" id="printBtn">Print</button>
            <button class="btn ghost" id="copyBtn">Copy result</button>
            <div class="copy-tip" id="copyTip" hidden>Copied!</div>
          </div>
        </div>

      </form>

      <footer>
        <p>Calculator uses the Deurenberg formula to estimate body fat: BF% = 1.20 × BMI + 0.23 × Age − 10.8 × Sex − 5.4. For adults only. Source: peer-reviewed literature.</p>
      </footer>
    </section>
  </main>

  <script>
    // ---- Utilities ----
    const el = id => document.getElementById(id);
    const toFloat = v => (v === '' || v == null) ? NaN : Number(v);

    // Elements
    const unitMetric = el('unitMetric');
    const unitImperial = el('unitImperial');
    const weightInput = el('weight');
    const heightInput = el('height');
    const ageInput = el('age');
    const sexInput = el('sex');
    const calculateBtn = el('calculateBtn');
    const resetBtn = el('resetBtn');
    const results = el('results');
    const bmiVal = el('bmiVal');
    const bmiCat = el('bmiCat');
    const bfVal = el('bfVal');
    const bfCat = el('bfCat');
    const improveTips = el('improveTips');
    const saveLocal = el('saveLocal');
    const printBtn = el('printBtn');
    const copyBtn = el('copyBtn');
    const copyTip = el('copyTip');

    // Unit state
    let units = 'metric'; // 'metric' or 'imperial'

    function setActiveUnit(button){
      [unitMetric, unitImperial].forEach(b=>b.classList.remove('active'));
      button.classList.add('active');
      unitMetric.setAttribute('aria-pressed', unitMetric === button);
      unitImperial.setAttribute('aria-pressed', unitImperial === button);
      units = (button === unitMetric) ? 'metric' : 'imperial';
      // update helper placeholders
      if(units === 'metric'){
        weightInput.value = roundOrDefault(weightInput.value, 70);
        heightInput.value = roundOrDefault(heightInput.value, 170);
      } else {
        weightInput.value = roundOrDefault(weightInput.value, 154); // lbs
        heightInput.value = roundOrDefault(heightInput.value, 67); // inches
      }
    }

    function roundOrDefault(v, d){
      const n = Number(v);
      if(isFinite(n) && n > 0) return Math.round(n * 10) / 10;
      return d;
    }

    unitMetric.addEventListener('click', () => setActiveUnit(unitMetric));
    unitImperial.addEventListener('click', () => setActiveUnit(unitImperial));

    function resetForm(){
      ageInput.value = 30;
      sexInput.value = '1';
      if(units === 'metric'){ weightInput.value = 70; heightInput.value = 170 } else { weightInput.value = 154; heightInput.value = 67 }
      results.hidden = true;
    }
    resetBtn.addEventListener('click', resetForm);

    // ---- Calculations ----
    function calculate(){
      const age = Math.round(toFloat(ageInput.value));
      const sex = Number(sexInput.value); // 1 male, 0 female
      let weight = toFloat(weightInput.value);
      let height = toFloat(heightInput.value);

      if(!(isFinite(age) && age >= 5 && age <= 120)) { alert('Please enter a valid age (5-120).'); return }
      if(!(isFinite(weight) && weight > 0)) { alert('Please enter a valid weight.'); return }
      if(!(isFinite(height) && height > 0)) { alert('Please enter a valid height.'); return }

      // Convert to metric
      if(units === 'imperial'){
        // pounds to kg, inches to cm
        weight = weight * 0.45359237; // lbs -> kg
        height = height * 2.54; // in -> cm
      }

      // BMI calculation: weight(kg) / (height(m))^2
      const heightM = height / 100.0;
      const bmiRaw = weight / (heightM * heightM);
      const bmi = roundTo(bmiRaw, 1);

      // Deurenberg body fat estimate: BF% = 1.20*BMI + 0.23*age - 10.8*sex - 5.4
      const bfRaw = (1.20 * bmiRaw) + (0.23 * age) - (10.8 * sex) - 5.4;
      const bf = roundTo(bfRaw, 1);

      // Categories
      const bmiCategory = bmiCategoryFor(bmi);
      const bfCategory = bfCategoryFor(bf, sex);

      // Render
      bmiVal.textContent = bmi;
      bmiCat.textContent = bmiCategory.label;
      bmiCat.style.color = bmiCategory.color;
      bfVal.textContent = bf + ' %';
      bfCat.textContent = bfCategory.label;
      bfCat.style.color = bfCategory.color;

      // Tips
      populateTips(bmiCategory.key, bfCategory.key);

      results.hidden = false;
      results.scrollIntoView({behavior:'smooth'});
    }

    function roundTo(n, decimals){
      const p = Math.pow(10, decimals || 0);
      return Math.round(n * p) / p;
    }

    function bmiCategoryFor(bmi){
      if(bmi < 18.5) return {label:'Underweight', key:'under', color:'var(--accent)'};
      if(bmi < 25) return {label:'Normal', key:'normal', color:'var(--success)'};
      if(bmi < 30) return {label:'Overweight', key:'over', color:'#f59e0b'};
      return {label:'Obese', key:'obese', color:'var(--danger)'};
    }

    // Simple body fat categories (approx): source: fitness industry guidance
    function bfCategoryFor(bf, sex){
      // sex: 1 male, 0 female
      if(sex === 1){
        if(bf < 6) return {label:'Below essential (very low)', key:'essential', color:'var(--accent)'};
        if(bf < 14) return {label:'Athlete', key:'athlete', color:'var(--success)'};
        if(bf < 18) return {label:'Fitness', key:'fitness', color:'var(--success)'};
        if(bf < 25) return {label:'Average', key:'average', color:'#f59e0b'};
        return {label:'High / Obese', key:'obese', color:'var(--danger)'};
      } else {
        if(bf < 14) return {label:'Below essential (very low)', key:'essential', color:'var(--accent)'};
        if(bf < 21) return {label:'Athlete', key:'athlete', color:'var(--success)'};
        if(bf < 25) return {label:'Fitness', key:'fitness', color:'var(--success)'};
        if(bf < 32) return {label:'Average', key:'average', color:'#f59e0b'};
        return {label:'High / Obese', key:'obese', color:'var(--danger)'};
      }
    }

    function populateTips(bmiKey, bfKey){
      const tips = [];
      // Basic tips (generic, educational)
      if(bmiKey === 'under') tips.push('Gain lean mass: prioritize protein-rich foods and progressive resistance training (3x / week).');
      if(bmiKey === 'normal') tips.push('Maintain by balanced diet and regular physical activity (150 min moderate aerobic + 2 strength sessions weekly).');
      if(bmiKey === 'over' || bmiKey === 'obese') tips.push('Focus on gradual weight loss (0.5-1 kg/week): calorie deficit of 300-500 kcal/day, increase protein and resistance training.');

      if(bfKey === 'athlete' || bfKey === 'fitness') tips.push('You have a fit body fat level — maintain strength training and adequate recovery.');
      if(bfKey === 'average') tips.push('Improve body composition with resistance training and moderate cardio; track protein intake and sleep.');
      if(bfKey === 'obese') tips.push('Consider a structured plan: consult a healthcare or registered dietitian for personalized guidance.');

      // universal tips
      tips.push('Prioritize sleep (7–9 hours) and manage stress — they impact body composition and appetite.');
      tips.push('Track progress with multiple measures: clothes fit, strength, and body measurements — not only the scale.');

      // Render tips
      improveTips.innerHTML = '';
      tips.forEach(t => {
        const li = document.createElement('li');
        li.textContent = t;
        improveTips.appendChild(li);
      });
    }

    calculateBtn.addEventListener('click', calculate);

    // ---- Save / copy / print ----
    saveLocal.addEventListener('click', ()=>{
      const payload = {
        ts: new Date().toISOString(),
        age: ageInput.value, sex: sexInput.value, units, weight: weightInput.value, height: heightInput.value,
        bmi: bmiVal.textContent, bf: bfVal.textContent
      };
      const key = 'eb_logger_bmi_history';
      const arr = JSON.parse(localStorage.getItem(key) || '[]');
      arr.push(payload);
      localStorage.setItem(key, JSON.stringify(arr));
      alert('Saved locally — view in browser storage.');
    });

    printBtn.addEventListener('click', ()=> window.print());

    copyBtn.addEventListener('click', ()=>{
      const txt = `BMI: ${bmiVal.textContent} — Body Fat: ${bfVal.textContent} — ${bmiCat.textContent} — ${bfCat.textContent}`;
      navigator.clipboard && navigator.clipboard.writeText ? navigator.clipboard.writeText(txt).then(()=>{
        copyTip.hidden = false; setTimeout(()=>copyTip.hidden=true,1500);
      }).catch(()=>{ alert('Copy failed — try manually.'); }) : alert('Copy not supported.');
    });

    // ---- Init ----
    (function init(){
      // default units metric
      setActiveUnit(unitMetric);
      // quick calculate for default values
      calculate();
    })();

  </script>
</body>
</html>
